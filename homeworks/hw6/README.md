# Проектирование инфраструктуры и CI/CD-пайплайна для развертывания приложения

## Цель:

Необходимо спроектировать и реализовать* автоматизированный процесс развертывания веб-приложения с использованием
подходов Infrastructure as Code (IaC) и CI/CD. Задание охватывает создание инфраструктуры, настройку конфигураций,
контейнеризацию приложения и внедрение CI/CD-пайплайнов для сборки, тестирования и деплоя.

## Описание/Пошаговая инструкция выполнения домашнего задания:

### Требования к выполнению.

1. Создание инфраструктуры

* Используя Terraform, опишите конфигурацию для создания базовой инфраструктуры:

    1. Виртуальные машины для приложения и базы данных (например, PostgreSQL).
    2. Сетевые ресурсы (VPC, подсети, security groups).
    3. Хранилище для логов или артефактов (S3-совместимый сервис или аналог).

* Приложите файл с конфигурацией .tf и инструкцию по применению.


2. Настройка конфигураций

* Используя Ansible, автоматизируйте:

    1. Установку Docker и необходимых зависимостей на виртуальных машинах.
    2. Настройку базы данных (создание пользователя и схемы).
    3. Развертывание вашего веб-приложения (на выбор: простой Flask/Django/Node.js приложение).

3. Контейнеризация приложения

* Создайте Dockerfile для приложения, описывающий:

  1. Установку всех зависимостей.
  2. Запуск приложения в контейнере.

* Подготовьте Kubernetes манифесты для деплоя контейнера:

    1. Deployment для приложения.
    2. Service для публикации приложения внутри кластера.
    

4. CI/CD-пайплайн:

   * Настройте пайплайн с использованием GitLab CI, Jenkins, или GitHub Actions:

   1. Этап сборки контейнера и публикации в Docker Registry.
   2. Этап интеграционного тестирования (например, запуск тестов приложения).
   3. Этап деплоя в Kubernetes кластер.

   Приложите файл конфигурации пайплайна .gitlab-ci.yml, Jenkinsfile, или .github/workflows.

5. Мониторинг и отчёты

   Добавьте этап логирования и отправки отчётов (например, уведомление в Telegram о статусе пайплайна).

---

Сэмплы практики, ранее применявшиеся в  пет-проектах:

### 1. Создание инфраструктуры

[на примере развертывания веб-приложения](https://github.com/vasiliev-alexey/otus_angie/tree/master/homeworks/hw08)

Создаем инфраструктуру с помощью Terraform в Yandex Cloud.

Полное описание инфраструктуры в файлах

* [Backend](./1/resources_be.tf)
* [Frontend](./1/resources_fe.tf)
* [DB](./1/resources_db.tf)
* [LoadBalancer](./1/resources_lb.tf)

### 2. Настройка конфигураций

1. Установку зависимостей пропускаем, поскольку наше приложение в сборке включает среду испольнения , соответсвующую
   процессорно архитектуре виртуальных машин и зависимости ( Single-file publishing )
2. [Настройка базы данных (создание пользователя и схемы)](./1/ansible/db.yml). Схема создается в старте приложения (
   миграции)
3. [Развертывание  backend сервиса, артефакты из S3-бакет](./1/ansible/be.yml)
4. [Развертывание  фронтенд сервиса на Angie, артефакты из S3-бакет](./1/ansible/fe.yml)
5. [Развертывание  LoadBalancer сервиса, с настройкой fail2ban](./1/ansible/lb.yml)

### 3. Контейнеризация приложения

1. [Dockerfile для сборки .Net приложения](./3/Dockerfile)  
2. [Docker-compose для развертывания приложения](./3/docker-compose.yml)
3. [Deployment для приложения](./3/deployment.yaml)

### 4. CI/CD
1. [CI/CD-пайплайн сборки и публикации в Docker Registry](./4/gha.yml) 
2. [CI/CD-пайплайн деплоя в GKE](https://github.com/vasiliev-alexey/otus_devops_project/blob/master/.github/workflows/gke.yml)

### 5. Мониторинг и отчёты
1. [Пример с логироваие и оповещением в TG](https://github.com/vasiliev-alexey/otus_react_course/blob/master/.github/workflows/sanity-check-deploy.yml)


---

Если нужен совсем полный проект - то он ранее реализован в [отдельном репозитории](https://github.com/vasiliev-alexey/otus_devops_project)