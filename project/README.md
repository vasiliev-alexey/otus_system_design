
<details>
<summary>Оглавление</summary

1. [Введение](#1-введение)
2. [Требования и ограничения](#2-требования-и-ограничения)
3. [Описание высокоуровневой архитектуры](#3-описание-высокоуровневой-архитектуры)

</details>


## 1. **Введение**

### Название системы:  
**WebInsight Analytics**

### Краткое описание:
- WebInsight Analytics — это информационная система, предназначенная для:
  - Сбора, хранения, анализа и визуализации данных о поведении пользователей на веб-сайтах
- Ключевые возможности:
  - Получение актуальных метрик и дашбордов в режиме реального времени
  - Помощь в принятии обоснованных маркетинговых решений
  - Оптимизация пользовательского опыта
  - Инструменты для:
    - Анализа трафика
    - Отслеживания конверсий
    - A/B-тестирования
    - Персонализации контента

### Основная цель системы:
Разработка единого аналитического решения, которое позволяет:
1. Автоматизировать сбор данных с различных источников:
   - Сайты
   - Мобильные приложения
   - CRM-системы
2. Обеспечивать:
   - Точность метрик
   - Актуальность данных в реальном времени
3. Упрощать принятие решений благодаря:
   - Интуитивным отчетам
   - Наглядным дашбордам
4. Соответствовать требованиям:
   - Регуляторных норм
   - Стандартов безопасности
---

## 2. **Требования и ограничения**  

### **2.1. Функциональные требования** *(то, что система должна делать)*  

1. **Сбор данных:**  
   - Отслеживание метрик посещаемости  
   - Сбор данных о действиях пользователей  
   - Отслеживание источников трафика  
   - Фиксирование событий (клики, отправка форм и др.)  

2. **Обработка и анализ данных:**  
   - Расчет ключевых метрик  
   - Построение воронок продаж  
   - Прогнозирование и анализ трендов  
   - Система должна хранить исторические данные за период не менее 3 лет.  
   - Система должна обеспечивать быструю обработку больших объемов данных (миллионы событий в день).  
   - Система должна поддерживать агрегацию данных в реальном времени и в режиме batch-обработки.  

3. **Визуализация и отчетность:**  
   - Генерация стандартных и настраиваемых отчетов  
   - Визуализация данных (графики, диаграммы)  
   - Интерактивные дашборды  
   - Экспорт данных  

4. **Интеграции:**  
   - REST API для экспорта/импорта данных  
   - Интеграция с CRM, ERP и другими системами  
   - Поддержка вебхуков  

5. **Уведомления:**  
   - Оповещения о значимых изменениях метрик  
   - Настраиваемые триггеры для алертов  

---

### **2.2. Нефункциональные требования** *(как система должна работать)*  

1. **Производительность:**  
   - Хранение исторических данных (глубина хранения данных не менее 3 лет)  
   - Быстрая обработка больших объемов данных  
   - Формирование отчетов за время не более 5 секунд  
   - Быстрая загрузка страниц вне зависимости от качества сети пользователя.  
   - Обработка большого количества одновременных запросов (не менее 1000 запросов в секунду для крупных клиентов)  

2. **Безопасность:**  
   - Поддержка мультитенантности данных  
   - Многоуровневая система прав доступа  
   - Двухфакторная аутентификация  
   - Шифрование данных  
   - Соответствие национальным стандартам безопасности  

3. **Надежность:**  
   - Аудит действий пользователей  
   - Высокая вероятность безотказной работы системы.  
   - Резервное копирование  
   - Быстрое восстановление после сбоев (время восстановления минимально)  

4. **Масштабируемость:**  
   - Горизонтальное масштабирование  
   - Поддержка работы с большими объемами данных  
   - Низкая стоимость масштабирования при росте объема данных или числа пользователей  

5. **Пользовательский интерфейс:**  
   - Интуитивно понятный интерфейс  
   - Мультиязычность  
   - Адаптивность под разные устройства  
   - Минимальное время отклика системы (например, не более 0,1 секунды в 80% случаев)  

6. **Обслуживание:**  
   - Регулярные обновления системы  
   - Техническая поддержка  
   - Наличие документации и обучающих материалов  

7. **Эффективность использования ресурсов:**  
   - Оптимальная нагрузка на серверы.  
   - Энергосбережение при выполнении операций анализа данных  

---


### 2.3 Ограничения системы

1. **Технологические ограничения**
   - Серверные мощности – невозможность обработки данных в реальном времени при высокой нагрузке (более 1 млн событий/минуту).
   - Горизонтальное масштабирование – не возможно увеличивать серверный мощности выделенных серверов, возможно только горизонтальное масштабирование.
   - Использование только open-source – запрет на коммерческие решения (например, только PostgreSQL вместо ClickHouse).

2. **Ограничения на сбор данных**
   - Серверные мощности – невозможнос
   - Устаревшие технологии сайтов – невозможность внедрения современных трекеров (например, на сайтах с jQuery 1.x).
   - Блокировка трекеров – Safari (ITP), Firefox (ETP), AdBlock/uBlock Origin скрывают до 30% трафика.
   - Лимиты на частоту сбора – данные отправляются раз в 1-5 минут, а не в реальном времени.

3. **Хранение данных**
   - Максимальный срок хранения – 36 месяцев, после чего данные автоматически удаляются.
   - Лимиты на объем – 10 Тб в месяц, далее требуется платное расширение.
   - Скорость записи – требуется система хранения сопобная справится с пиковыми нагрузками (например, Black Friday).

4. **Интеграции**
   - Ограничения API – Google Analytics, Meta Ads и другие сервисы имеют квоты (например, 10 запросов/секунду).
   - Отсутствие поддержки редких CRM – нет интеграции с нишевыми системами (например, 1С-Битрикс).

5. **Производительность**
   - Задержки отчетов – сложные аналитические запросы выполняются дольше 10 секунд.
   - Ограниченный параллелизм – система не может генерировать более 50 отчетов одновременно.

6. **Регуляторные ограничения**
   - GDPR (ЕС) – обязательное согласие на сбор данных, право на удаление.
   - 152-ФЗ (Россия) – хранение персональных данных только на серверах в РФ.
   - CCPA (Калифорния) – запрет на продажу данных без согласия.

7. **Бюджетные ограничения**
   - Нет денег на коммерческие решения – только бесплатные аналоги (Matomo вместо Adobe Analytics).
   - Ограниченный штат – 10-20 разработчика вместо полноценной команды проекта.

8. **Организационные ограничения**
   - Нехватка экспертов – нет на рынке экспертов для найма по направлению Data Engineer, DevOps, аналитиков.
   - Сопротивление внедрению – сотрудники не хотят переходить на новую систему.

9. **Прочие ограничения**
   - Боты и фейки – до 15% трафика может быть нерелевантным.
   - Кросс-девайс трекинг – нельзя точно связать пользователя на ПК и смартфоне.




## 3. Описание высокоуровневой архитектуры

### Пользователи → Система веб-аналитики
- Пользователи взаимодействуют с системой через **веб-интерфейс** или **API** для:
  - Получения отчетов
  - Анализа данных
  - Настройки параметров

### Веб-сайты и мобильные приложения → Система веб-аналитики
- Веб-сайты и мобильные приложения отправляют данные о поведении пользователей через:
  - JavaScript-теги
  - Пиксели отслеживания
  - Серверные логи

### Сторонние сервисы ↔ Система веб-аналитики
- Интеграция с рекламными платформами (**Google Ads**, **Facebook Ads**) для получения данных о кампаниях.
- Интеграция с **CRM-системами** для анализа поведения клиентов.
- Использование облачных хранилищ (**AWS**, **Google Cloud**) для хранения больших объемов данных.

### API ↔ Система веб-аналитики
- API используется для автоматизации процессов, таких как:
  - Отправка уведомлений
  - Запуск рекламных кампаний

![Верхнеуровневая архитектура](./img/hld.png)


![Детальная архитектура](./img/lld.png)

